version: "3.9"
services:
  hana:
    build:
      context: ..
      dockerfile: hana/Dockerfile
    environment:
      - HANA_DSN=${HANA_DSN}
      - PORT=8083
    ports:
      - "8083:8083"

  gateway:
    build:
      context: ../gateway
    environment:
      - HANA_URL=http://hana:8083
      - GATEWAY_PORT=8000
    ports:
      - "8000:8000"
    depends_on:
      - hana

  postgres:
    image: ankane/pgvector:latest
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_DB=amodels
    ports:
      - "5432:5432"

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  opensearch:
    image: opensearchproject/opensearch:2.14.0
    environment:
      - discovery.type=single-node
      - plugins.security.disabled=true
      - OPENSEARCH_JAVA_OPTS=-Xms1g -Xmx1g
    ulimits:
      nofile:
        soft: 65536
        hard: 65536
    ports:
      - "9200:9200"
      - "9600:9600"


